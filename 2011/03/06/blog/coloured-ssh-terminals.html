<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <title>Coloured SSH terminals - Michael Mior</title>
    <link href='/styles.css' rel='stylesheet'>
    <link href='/img/favicon.ico' rel='icon'>
    <meta content='nanoc 3.6.5' name='generator'>
    <link href='/atom.xml' rel='alternate' title='Michael Mior' type='application/atom+xml'>
  </head>
  <body class='single-post'>
    <div class='hfeed' id='wrapper'>
      <div id='header'>
        <div id='blog-title'>
          <h1>
            <a href='/' rel='home' title='Michael Mior'>
              <span class='word-1'>Michael</span>
              <span class='word-2'>Mior</span>
            </a>
          </h1>
        </div>
        <div id='access'>
          <div class='skip-link'>
            <a href='#content' title='Skip navigation to the content'></a>
          </div>
          <div class='menu'>
            <ul class='sf-menu'>
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/about/">About</a>
              </li>
              <li>
                <a href="/contact/">Contact</a>
              </li>
              <li>
                <a href="/blog/archive/2012.html">Blog</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id='main'>
      <div id='container'>
        <div id='content'>
          <div class='post hentry'>
  <h1 class='entry-title'>Coloured SSH terminals</h1>
  <div class='entry-content'>&#x000A;            <p>With the looming prospect of deploying software to production systems and horror stories of accidental commands executed on production systems instead of development machines, I wanted to try to find a way to ensure this never happened to&nbsp;me.&#x000A;            My first thought was to change the background colour of the terminal as that would be a clear indicator of the system I’m connected&nbsp;to.&#x000A;            Unfortunately, gnome-terminal doesn’t allow changing the background colour of a running terminal and I don’t always want to launch a new terminal to&nbsp;<span class="caps">SSH.</span>&#x000A;            Fortunately, I found a&nbsp;solution.</p>&#x000A;            &#x000A;            <p>While doing some research on the possibility of changing the <code>gnome-terminal</code> background, I came across <a href="http://roxterm.sourceforge.net/">ROXTerm</a>.&#x000A;            ROXTerm has a <span class="caps">DBUS</span> interface which can be used to control profiles and colour scheme of an open&nbsp;terminal.&#x000A;            Unfortunately, the documentation on this interface is a little&nbsp;light.&#x000A;            Thanks to <a href="http://news.ycombinator.com/user?id=shimon">shimon</a> for his comment on <a href="http://news.ycombinator.com/item?id=2089159">this post</a> on Hacker&nbsp;News.</p>&#x000A;            &#x000A;            <p>I created a new colour scheme titled “Warning” including a red background with the intent of using this in any terminals where I know I need to be extra&nbsp;careful.</p>&#x000A;            &#x000A;            <div>&#x000A;            <div class="CodeRay">&#x000A;              <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>dbus-send --session /net/sf/roxterm/Options net.sf.roxterm.Options.SetColourScheme string:$ROXTERM_ID "string:Warning"&#x000A;            </pre></div>&#x000A;            </div>&#x000A;            </div>&#x000A;            &#x000A;            <p>The next step was to get this command executed every time I connect to one of these&nbsp;servers.&#x000A;            I first created a simple script to save some typing, <code>roxterm-colour</code>. I placed this in <code>~/bin</code> (make sure to add this to your&nbsp;<code>PATH</code>).</p>&#x000A;            &#x000A;            <div>&#x000A;            <div class="CodeRay">&#x000A;              <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>#!/bin/sh&#x000A;            <span class="line-numbers"><a href="#n2" name="n2">2</a></span>if [ -n $ROXTERM_ID ]; then&#x000A;            <span class="line-numbers"><a href="#n3" name="n3">3</a></span>dbus-send --session /net/sf/roxterm/Options net.sf.roxterm.Options.SetColourScheme string:$ROXTERM_ID "string:$1"&#x000A;            <span class="line-numbers"><a href="#n4" name="n4">4</a></span>fi&#x000A;            </pre></div>&#x000A;            </div>&#x000A;            </div>&#x000A;            &#x000A;            <p>Using a local ssh config file in <code>~/.ssh/config</code> allows you to set connection-specific&nbsp;options.&#x000A;            The configuration settings below show how the colour scheme can be changed whenever the production system is connected&nbsp;to.</p>&#x000A;            &#x000A;            <div>&#x000A;            <div class="CodeRay">&#x000A;              <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>Host prod&#x000A;            <span class="line-numbers"><a href="#n2" name="n2">2</a></span>Hostname production.example.com&#x000A;            <span class="line-numbers"><a href="#n3" name="n3">3</a></span>LocalCommand roxterm-colour Warning&#x000A;            </pre></div>&#x000A;            </div>&#x000A;            </div>&#x000A;            &#x000A;            <p>Now I can connect via ssh prod and the colour changes as&nbsp;expected.&#x000A;            The remaining problem is resetting the colour scheme as soon as the connection is&nbsp;broken.&#x000A;            Unfortunately, <span class="caps">SSH</span> doesn’t have any option to allow the execution of a command when a connection is&nbsp;broken.&#x000A;            For this, I created a simple script to alias <span class="caps">SSH</span> and reset the colour scheme after the connection&nbsp;dies.&#x000A;            This sits in <code>~/bin/ssh</code>. In this case, you must ensure that <code>~/bin</code> comes before <code>/usr/bin</code> in your&nbsp;<code>PATH</code>.</p>&#x000A;            &#x000A;            <div>&#x000A;            <div class="CodeRay">&#x000A;              <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>#!/bin/sh&#x000A;            <span class="line-numbers"><a href="#n2" name="n2">2</a></span>trap "roxterm-colour Tango" EXIT&#x000A;            <span class="line-numbers"><a href="#n3" name="n3">3</a></span>/usr/bin/ssh $*&#x000A;            </pre></div>&#x000A;            </div>&#x000A;            </div>&#x000A;            &#x000A;            <p>The <code>trap</code> command ensures that the colour scheme will be reset whenever the script exits (my default colour scheme is&nbsp;Tango).&#x000A;            Finally, I also found that if I open a new tab while SSHed into a coloured terminal, this tab will also take on the same&nbsp;colour.&#x000A;            Therefore, I also added roxterm-colour Tango to my .bashrc so the colour would be reset with every new&nbsp;terminal.</p>&#x000A;            &#x000A;            <p>I’m pretty happy with this setup and hoping it will help keep me from making any disastrous&nbsp;mistakes.&#x000A;            I’ve now replaced gnome-terminal with roxterm as my&nbsp;default.&#x000A;            Know any other tips on avoiding mistakes for production&nbsp;systems?&#x000A;            Let me know in the&nbsp;comments!</p>&#x000A;</div>&#x000A;<div id='disqus_thread'>&#x000A;  <script>&#x000A;    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */&#x000A;    var disqus_shortname = 'michaelmior'; // required: replace example with your forum shortname&#x000A;    &#x000A;    /* * * DON'T EDIT BELOW THIS LINE * * */&#x000A;    (function() {&#x000A;      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;&#x000A;      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';&#x000A;      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);&#x000A;    })();&#x000A;  </script>&#x000A;  <noscript>&#x000A;    Please enable JavaScript to view the&#x000A;    <a href='https://disqus.com/?ref_noscript'>&#x000A;      comments powered by Disqus.&#x000A;    </a>&#x000A;  </noscript>&#x000A;  <a class='dsq-brlink' href='https://disqus.com'>&#x000A;    comments powered by&#x000A;    <span class='logo-disqus'>&#x000A;      Disqus&#x000A;    </span>&#x000A;  </a>&#x000A;</div>
</div>

        </div>
      </div>
    </div>
    <div id='footer'>
      <div id='siteinfo'>
        &copy; 2013 Michael Mior
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-45085128-1', 'mior.ca');
      ga('send', 'pageview');
      
      var heap=heap||[];heap.load=function(a){window._heapid=a;var b=document.createElement('script');b.async=!0,b.src='//cdn.heapanalytics.com/js/heap.js';var c=document.getElementsByTagName('script')[0];c.parentNode.insertBefore(b,c);var d=function(a){return function(){heap.push([a].concat(Array.prototype.slice.call(arguments,0)))}},e=['identify','track'];for(var f=0;f<e.length;f++)heap[e[f]]=d(e[f])};
      heap.load('1282501007');
    </script>
  </body>
</html>
