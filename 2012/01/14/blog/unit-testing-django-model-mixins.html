<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <title>Unit testing Django model mixins - Michael Mior</title>
    <link href='/styles.css' rel='stylesheet'>
    <link href='/img/favicon.ico' rel='icon'>
    <meta content='nanoc 3.8.0' name='generator'>
    <link href='/atom.xml' rel='alternate' title='Michael Mior' type='application/atom+xml'>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700|Hind:400,700' rel='stylesheet'>
  </head>
  <body class='single-post'>
    <div class='hfeed' id='wrapper'>
      <div id='header'>
        <div id='blog-title'>
          <h1>
            <a href='/' rel='home' title='Michael Mior'>
              <span class='word-1'>Michael</span>
              <span class='word-2'>Mior</span>
            </a>
          </h1>
        </div>
        <div id='access'>
          <div class='skip-link'>
            <a href='#content' title='Skip navigation to the content'></a>
          </div>
          <div class='menu'>
            <ul class='sf-menu'>
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/about/">About</a>
              </li>
              <li>
                <a href="/contact/">Contact</a>
              </li>
              <li>
                <a href="/blog/archive/2015.html">Blog</a>
              </li>
              <li>
                <a href="/projects/">Projects</a>
              </li>
              <li>
                <a href="/publications/">Publications</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id='main'>
      <div id='container'>
        <div id='content'>
          <div class='post hentry'>
  <h1 class='entry-title'>Unit testing Django model mixins</h1>
  <div class='entry-content'>&#x000A;            <p>I recently found myself having to unit test some model mixins and I thought I would share the technique I used in case anyone else finds it&nbsp;useful.&#x000A;            You could just pick a model which uses the mixin and run the test on instances of that&nbsp;model.&#x000A;            But the goal of a mixin is to provide reusable functionality independent of any&nbsp;model.&#x000A;            Instead, we create a dummy model we can use for&nbsp;testing.</p>&#x000A;            &#x000A;            <p>The model shouldn’t reside in <code>models.py</code> since we don’t want it in our&nbsp;database.&#x000A;            Instead, we create the model&nbsp;dynamically.&#x000A;            However, I wanted to test some functionality which requires saving the model to the&nbsp;database.&#x000A;            Fortunately, Django can construct the necessary <span class="caps">SQL</span> to create and destroy the database&nbsp;table.&#x000A;            we simply override setUp and tearDown to do the heavy&nbsp;lifting.</p>&#x000A;            &#x000A;            <div class="highlighter-coderay">&#x000A;            <div class="CodeRay">&#x000A;              <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">django.test</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">TestCase</span>&#x000A;            <span class="line-numbers"> <a href="#n2" name="n2">2</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">django.db</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">connection</span>&#x000A;            <span class="line-numbers"> <a href="#n3" name="n3">3</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">django.core.management.color</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">no_style</span>&#x000A;            <span class="line-numbers"> <a href="#n4" name="n4">4</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">django.db.models.base</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">ModelBase</span>&#x000A;            <span class="line-numbers"> <a href="#n5" name="n5">5</a></span>&#x000A;            <span class="line-numbers"> <a href="#n6" name="n6">6</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ModelMixinTestCase</span>(TestCase):&#x000A;            <span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    <span style="color:#D42"><span style="color:black">"""</span><span></span></span>&#x000A;            <span class="line-numbers"> <a href="#n8" name="n8">8</a></span><span style="color:#D42"><span></span><span>    Base class for tests of model mixins. To use, subclass and specify</span><span></span></span>&#x000A;            <span class="line-numbers"> <a href="#n9" name="n9">9</a></span><span style="color:#D42"><span></span><span>    the mixin class variable. A model using the mixin will be made</span><span></span></span>&#x000A;            <span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span><span style="color:#D42"><span></span><span>    available in self.model.</span><span></span></span>&#x000A;            <span class="line-numbers"><a href="#n11" name="n11">11</a></span><span style="color:#D42"><span></span><span>    </span><span style="color:black">"""</span></span>&#x000A;            <span class="line-numbers"><a href="#n12" name="n12">12</a></span>&#x000A;            <span class="line-numbers"><a href="#n13" name="n13">13</a></span>    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">setUp</span>(<span style="color:#069">self</span>):&#x000A;            <span class="line-numbers"><a href="#n14" name="n14">14</a></span>        <span style="color:#777"># Create a dummy model which extends the mixin</span>&#x000A;            <span class="line-numbers"><a href="#n15" name="n15">15</a></span>        <span style="color:#069">self</span>.model = ModelBase(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__TestModel__</span><span style="color:#710">'</span></span>+<span style="color:#069">self</span>.mixin.__name__, (<span style="color:#069">self</span>.mixin,),&#x000A;            <span class="line-numbers"><a href="#n16" name="n16">16</a></span>            { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__module__</span><span style="color:#710">'</span></span>: <span style="color:#069">self</span>.mixin.__module__ })&#x000A;            <span class="line-numbers"><a href="#n17" name="n17">17</a></span>&#x000A;            <span class="line-numbers"><a href="#n18" name="n18">18</a></span>        <span style="color:#777"># Create the schema for our test model</span>&#x000A;            <span class="line-numbers"><a href="#n19" name="n19">19</a></span>        <span style="color:#069">self</span>._style = no_style()&#x000A;            <span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>        sql, _ = connection.creation.sql_create_model(<span style="color:#069">self</span>.model, <span style="color:#069">self</span>._style)&#x000A;            <span class="line-numbers"><a href="#n21" name="n21">21</a></span>&#x000A;            <span class="line-numbers"><a href="#n22" name="n22">22</a></span>        <span style="color:#069">self</span>._cursor = connection.cursor()&#x000A;            <span class="line-numbers"><a href="#n23" name="n23">23</a></span>        <span style="color:#080;font-weight:bold">for</span> statement <span style="color:#080;font-weight:bold">in</span> sql:&#x000A;            <span class="line-numbers"><a href="#n24" name="n24">24</a></span>            <span style="color:#069">self</span>._cursor.execute(statement)&#x000A;            <span class="line-numbers"><a href="#n25" name="n25">25</a></span>&#x000A;            <span class="line-numbers"><a href="#n26" name="n26">26</a></span>    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">tearDown</span>(<span style="color:#069">self</span>):&#x000A;            <span class="line-numbers"><a href="#n27" name="n27">27</a></span>        <span style="color:#777"># Delete the schema for the test model</span>&#x000A;            <span class="line-numbers"><a href="#n28" name="n28">28</a></span>        sql = connection.creation.sql_destroy_model(<span style="color:#069">self</span>.model, (), <span style="color:#069">self</span>._style)&#x000A;            <span class="line-numbers"><a href="#n29" name="n29">29</a></span>        <span style="color:#080;font-weight:bold">for</span> statement <span style="color:#080;font-weight:bold">in</span> sql:&#x000A;            <span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>            <span style="color:#069">self</span>._cursor.execute(statement)&#x000A;            </pre></div>&#x000A;            </div>&#x000A;            </div>&#x000A;            &#x000A;            <p>To make use of this code, just subclass from <code>ModelMixinTestCase</code> and set the mixin class variable to the model mixin class you wish to&nbsp;test.&#x000A;            You’ll then have access to a fully functioning model which uses this mixin via&nbsp;<code>self.model</code>.&#x000A;            Happy&nbsp;testing!</p>&#x000A;</div>
</div>

        </div>
      </div>
    </div>
    <div id='footer'>
      <div id='siteinfo'>
        &copy; 2013 Michael Mior
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-45085128-1', 'mior.ca');
      ga('require', 'linkid', 'linkid.js');
      ga('send', 'pageview');
      
      window.heap=window.heap||[],heap.load=function(t,e){window.heap.appid=t,window.heap.config=e;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+t+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(t){return function(){heap.push([t].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load('1282501007');
    </script>
  </body>
</html>
