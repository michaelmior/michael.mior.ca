<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <title>Cassandra benchmarking - Michael Mior</title>
    <link href='/styles.css' rel='stylesheet'>
    <link href='/img/favicon.ico' rel='icon'>
    <meta content='nanoc 3.8.0' name='generator'>
    <link href='/atom.xml' rel='alternate' title='Michael Mior' type='application/atom+xml'>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700|Hind:400,700' rel='stylesheet'>
  </head>
  <body class='single-post'>
    <div class='hfeed' id='wrapper'>
      <div id='header'>
        <div id='blog-title'>
          <h1>
            <a href='/' rel='home' title='Michael Mior'>
              <span class='word-1'>Michael</span>
              <span class='word-2'>Mior</span>
            </a>
          </h1>
        </div>
        <div id='access'>
          <div class='skip-link'>
            <a href='#content' title='Skip navigation to the content'></a>
          </div>
          <div class='menu'>
            <ul class='sf-menu'>
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/about/">About</a>
              </li>
              <li>
                <a href="/contact/">Contact</a>
              </li>
              <li>
                <a href="/blog/archive/2015.html">Blog</a>
              </li>
              <li>
                <a href="/projects/">Projects</a>
              </li>
              <li>
                <a href="/publications/">Publications</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id='main'>
      <div id='container'>
        <div id='content'>
          <div class='post hentry'>
  <h1 class='entry-title'>Cassandra benchmarking</h1>
  <div class='entry-content'>&#x000A;            <p>I was recently trying to run some benchmarks against <a href="http://cassandra.apache.org/">Cassandra</a> on <a href="http://aws.amazon.com/ec2/"><span class="caps">EC2</span></a> since unfortunately the servers I had in our machine room were destroyed in a&nbsp;fire.&#x000A;            For all my local testing, I used a single instance running on my desktop machine, but I wanted to ramp things up for the real benchmarks and use three&nbsp;nodes.&#x000A;            Since my workload is read-only and the dataset is fairly small, I also wanted a replication factor of three so each node would have a copy of all the&nbsp;data.</p>&#x000A;            &#x000A;            <p>My first attempt to load all this data was to follow <a href="http://www.datastax.com/documentation/cql/3.0/cql/cql_using/update_ks_rf_t.html">some documentation</a> provided by&nbsp;DataStax.&#x000A;            Their suggestion was to use <code>ALTER KEYSPACE</code> in <span class="caps">CQL</span> to change the replication factor, and then simply run <code>nodetool repair</code> on each&nbsp;node.&#x000A;            However, I found that running repair on just one node took several hours for a modest-sized amount of data&nbsp;(~<span class="caps">2GB</span>).&#x000A;            This was a pretty big time sink as I wanted to able to quickly spin up and down a cluster for&nbsp;testing.</p>&#x000A;            &#x000A;            <p>Next I tried changing the configured replication factor locally before exporting the&nbsp;data.&#x000A;            I then simply copied the data to all nodes in the cluster and tried to start them as&nbsp;normal.&#x000A;            This created some weird conflicts as nodes seemed to be confused about who owned what portion of&nbsp;data.</p>&#x000A;            &#x000A;            <p>Finally, I simply loaded up the data set on a single node and configured a replication factor of&nbsp;three.&#x000A;            I then started each node in sequence and the auto bootstrapping process took care of copying the entire dataset to each node in the&nbsp;cluster.&#x000A;            This whole process was complete in less than half an&nbsp;hour.&#x000A;            This approach wouldnâ€™t really work in a production setting since it assumes the node has no existing data (although if you can afford to bring a node offline for a while, I suppose that it might&nbsp;work).&#x000A;            In any case, this solution worked great for me and hopefully someone else finds this&nbsp;useful.</p>&#x000A;</div>
</div>

        </div>
      </div>
    </div>
    <div id='footer'>
      <div id='siteinfo'>
        &copy; 2016 Michael Mior
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-45085128-1', 'mior.ca');
      ga('require', 'linkid', 'linkid.js');
      ga('send', 'pageview');
      
      window.heap=window.heap||[],heap.load=function(t,e){window.heap.appid=t,window.heap.config=e;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+t+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(t){return function(){heap.push([t].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load('1282501007');
    </script>
  </body>
</html>
