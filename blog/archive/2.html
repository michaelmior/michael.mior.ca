<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <title>Archive (articles 6 to 10) - Michael Mior</title>
    <link href='/styles.css' rel='stylesheet'>
    <link href='/img/favicon.ico' rel='icon'>
    <meta content='nanoc 3.6.4' name='generator'>
    <link href='/atom.xml' rel='alternate' title='Michael Mior' type='application/atom+xml'>
  </head>
  <body class='home page'>
    <div class='hfeed' id='wrapper'>
      <div id='header'>
        <div id='blog-title'>
          <h1>
            <a href='/' rel='home' title='Michael Mior'>
              <span class='word-1'>Michael</span>
              <span class='word-2'>Mior</span>
            </a>
          </h1>
        </div>
        <div id='access'>
          <div class='skip-link'>
            <a href='#content' title='Skip navigation to the content'></a>
          </div>
          <div class='menu'>
            <ul class='sf-menu'>
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/about/">About</a>
              </li>
              <li>
                <a href="/contact/">Contact</a>
              </li>
              <li>
                <a href="/blog/archive/1.html">Blog</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id='main'>
      <div id='container'>
        <div id='content'>
          <div class='page hentry'>
            <h1 class='entry-title'>Archive (articles 6 to 10)</h1>
            <div class='entry-content'>&#x000A;  <h1><a href="/2010/12/02/blog/designing-an-offline-cms.html">Designing an Offline&nbsp;<span class="caps">CMS</span></a></h1>&#x000A;  <p>First the obvious&nbsp;question.&#x000A;  What on earth is an offline&nbsp;<span class="caps"><span class="caps">CMS</span></span>?&#x000A;  Isn’t the whole point of having a <span class="caps"><span class="caps">CMS</span></span> that you don’t have to change anything offline? Well, yes that’s&nbsp;true.&#x000A;  But recently I ran into a&nbsp;problem.</p>&#x000A;  &#x000A;  <p>When I started my Masters degree, the department wanted me to create a webpage, but all I could really do was serve boring old static&nbsp;content.&#x000A;  Well, that’s not entirely true, since there was an offer to set up a reverse proxy with my own <span class="caps"><span class="caps">LAMP</span></span> stack, but that seemed like overkill for my humble little&nbsp;homepage.&#x000A;  I also knew that I sure didn’t want to have to edit pages one by one every time I wanted to change common&nbsp;content.&#x000A;  I also didn’t want to have to upload things manually every time things&nbsp;changed.</p>&#x000A;  &#x000A;  <p>I did some searching around, and I decided to start with the <a href="http://www.cheetahtemplate.org/">Cheetah</a> template&nbsp;engine.&#x000A;  It’s got basically all the template goodness you need and a nice, clean&nbsp;syntax.&#x000A;  So I created some Cheetah templates, and wrote a little script to generate all my files, and everything worked just&nbsp;fine.&#x000A;  But I didn’t want to stop&nbsp;there.&#x000A;  So I decided to throw in some of the <a href="http://wiseheartdesign.com/articles/2010/01/18/the-demise-of-css-why-sass-and-languages-like-it-will-triumph/">goodness of <span class="caps"><span class="caps">SASS</span></span></a>.&#x000A;  (If you’re not familiar with <span class="caps"><span class="caps">SASS</span></span>, check out the link, it’ll change your&nbsp;life.)&#x000A;  Finally, just for good measure, I decided to throw in cssoptimizer and <a href="http://www.crockford.com/javascript/jsmin.html">jsmin</a> to pack everything down to&nbsp;size.</p>&#x000A;  &#x000A;  <p>Finally, just to satisfy my aching fingers, I decided to write a Makefile that would perform the whole shebang: generate the static <span class="caps"><span class="caps">HTML</span></span>, optimize <span class="caps"><span class="caps">JS</span></span> and <span class="caps"><span class="caps">CSS</span></span> code, and upload any changes to the&nbsp;server.</p>&#x000A;  &#x000A;  <div>&#x000A;  <div class="CodeRay">&#x000A;    <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>SERVER = yourserverhere&#x000A;  <span class="line-numbers"> <a href="#n2" name="n2">2</a></span>&#x000A;  <span class="line-numbers"> <a href="#n3" name="n3">3</a></span>JS = $(wildcard src/js/*.js)&#x000A;  <span class="line-numbers"> <a href="#n4" name="n4">4</a></span>JS_OPT = $(patsubst src/js/%.js,web/js/%.js, $(JS))&#x000A;  <span class="line-numbers"> <a href="#n5" name="n5">5</a></span>&#x000A;  <span class="line-numbers"> <a href="#n6" name="n6">6</a></span>SASS = $(wildcard src/sass/*.sass)&#x000A;  <span class="line-numbers"> <a href="#n7" name="n7">7</a></span>CSS = $(patsubst src/sass/%.sass,web/css/%.css, $(SASS))&#x000A;  <span class="line-numbers"> <a href="#n8" name="n8">8</a></span>&#x000A;  <span class="line-numbers"> <a href="#n9" name="n9">9</a></span>TMPL = $(wildcard src/tmpl/*.tmpl)&#x000A;  <span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>TMPL_INC = $(wildcard src/tmpl/inc/*.tmpl)&#x000A;  <span class="line-numbers"><a href="#n11" name="n11">11</a></span>HTM = $(patsubst src/tmpl/%.tmpl,web/%.htm, $(TMPL))&#x000A;  <span class="line-numbers"><a href="#n12" name="n12">12</a></span>&#x000A;  <span class="line-numbers"><a href="#n13" name="n13">13</a></span># Build all JavaScript, CSS, and XHTML files&#x000A;  <span class="line-numbers"><a href="#n14" name="n14">14</a></span>all: $(JS_OPT) $(CSS) $(HTM)&#x000A;  <span class="line-numbers"><a href="#n15" name="n15">15</a></span>&#x000A;  <span class="line-numbers"><a href="#n16" name="n16">16</a></span># Remove all built files from the output directory&#x000A;  <span class="line-numbers"><a href="#n17" name="n17">17</a></span>clean:&#x000A;  <span class="line-numbers"><a href="#n18" name="n18">18</a></span> rm -f web/*.htm&#x000A;  <span class="line-numbers"><a href="#n19" name="n19">19</a></span> rm -f web/js/*.js    rm -f web/css/*.css&#x000A;  <span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>&#x000A;  <span class="line-numbers"><a href="#n21" name="n21">21</a></span># Upload the final site to the server&#x000A;  <span class="line-numbers"><a href="#n22" name="n22">22</a></span>put: all&#x000A;  <span class="line-numbers"><a href="#n23" name="n23">23</a></span> rsync -avr --delete web/ $(SERVER):~/public_html&#x000A;  <span class="line-numbers"><a href="#n24" name="n24">24</a></span>&#x000A;  <span class="line-numbers"><a href="#n25" name="n25">25</a></span># Optimize JavaScript files&#x000A;  <span class="line-numbers"><a href="#n26" name="n26">26</a></span>$(JS_OPT): web/js/%.js: src/js/%.js&#x000A;  <span class="line-numbers"><a href="#n27" name="n27">27</a></span> cat $&lt; | ./bin/jsmin &gt; $@&#x000A;  <span class="line-numbers"><a href="#n28" name="n28">28</a></span>&#x000A;  <span class="line-numbers"><a href="#n29" name="n29">29</a></span># Optimize CSS files&#x000A;  <span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>$(CSS): web/css/%.css: src/sass/%.sass&#x000A;  <span class="line-numbers"><a href="#n31" name="n31">31</a></span> sass $&lt; | ./bin/cssoptimizer -i $@&#x000A;  <span class="line-numbers"><a href="#n32" name="n32">32</a></span>&#x000A;  <span class="line-numbers"><a href="#n33" name="n33">33</a></span># Ensure XHTML is rebuilt when included templates change&#x000A;  <span class="line-numbers"><a href="#n34" name="n34">34</a></span>$(HTM): $(TMPL_INC)&#x000A;  <span class="line-numbers"><a href="#n35" name="n35">35</a></span>&#x000A;  <span class="line-numbers"><a href="#n36" name="n36">36</a></span>$(HTM): web/%.htm: src/tmpl/%.tmpl&#x000A;  <span class="line-numbers"><a href="#n37" name="n37">37</a></span> (cd src/tmpl; cheetah fill --nobackup --oext=$(suffix $@) --odir=../../$(dir $@) $(notdir $&lt;))&#x000A;  </pre></div>&#x000A;  </div>&#x000A;  </div>&#x000A;  &#x000A;  <p>To get this to work for you, you should just be able to change <code>SERVER</code> to the address of your web&nbsp;server.&#x000A;  The directory structure I used looks like&nbsp;this:</p>&#x000A;  &#x000A;  <ul>&#x000A;  <li>bin</li>&#x000A;    <li>src&#x000A;      <ul>&#x000A;  <li>tmpl&#x000A;          <ul>&#x000A;  <li>inc</li>&#x000A;          </ul>&#x000A;  </li>&#x000A;        <li>sass</li>&#x000A;        <li>js</li>&#x000A;      </ul>&#x000A;  </li>&#x000A;    <li>web&#x000A;      <ul>&#x000A;  <li>img</li>&#x000A;      </ul>&#x000A;  </li>&#x000A;  </ul><p>Finally, here’s a complete list of download locations for all the tools I&nbsp;used:</p>&#x000A;  &#x000A;  <ul>&#x000A;  <li><a href="http://sass-lang.com/">Sass – Syntactically Awesome&nbsp;Stylesheets</a></li>&#x000A;    <li><a href="http://www.crockford.com/javascript/jsmin.html"><span class="caps"><span class="caps">JSMIN</span></span>, The JavaScript&nbsp;Minifier</a></li>&#x000A;    <li><a href="http://mabblog.com/cssoptimizer/download.html"><span class="caps"><span class="caps">CSS</span></span>&nbsp;Optimizer</a></li>&#x000A;  </ul><p>I found out when researching for this post that <a href="http://twitter.com/lakshmivyas">Lakshmi Vyas</a> has already come up with a solution called <a href="http://ringce.com/hyde">Hyde</a> for&nbsp;Python.&#x000A;  There is also <a href="http://jekyllrb.com/">jekyll</a> which uses&nbsp;Ruby.&#x000A;  This just gives you more approaches to building a custom tool that suits your&nbsp;needs.</p>&#x000A;  &#x000A;  <p>If you have any tips for generating static web content, post in the&nbsp;comments!</p>&#x000A;  <h1><a href="/2010/11/14/blog/octotweets.html">Octotweets</a></h1>&#x000A;  <p>Below is a few more links from my latest tweets from the end of&nbsp;October.&#x000A;  As always, you can follow me as <a href="http://www.twitter.com/michaelmior">@michaelmior</a> on&nbsp;Twitter.&#x000A;  For a list of all the links I’ve shared, you can view <a href="http://www.delicious.com/michaelmior">my delicious page</a>.&#x000A;  This list is generated by the wonderful <a href="http://packrati.us/">Packrati.us</a>&nbsp;app.</p>&#x000A;  &#x000A;  <ul>&#x000A;  <li>&#x000A;      <p><a href="http://octobot.taco.cat/">Octobot - High Throughput Distributed Task&nbsp;Queue</a></p>&#x000A;  &#x000A;      <p>I will admit that this one makes the list partially because the project’s awesome&nbsp;<span class="caps"><span class="caps">URL.</span></span>&#x000A;  But of course, it’s also very&nbsp;useful.&#x000A;  Octobot is capable of connecting to several task queues to process jobs with high&nbsp;throughput.&#x000A;  This is great for those of you developing web&nbsp;apps.&#x000A;  Task queues are one the best ways to hide high-latency operations from your&nbsp;users.&#x000A;  One of the great things about Octobot is that it supports so many different message&nbsp;queues.&#x000A;  Definitely worth a&nbsp;look.</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://www.kriesi.at/archives/15-useful-wordpress-functions-you-probably-dont-know">15 useful WordPress Functions you probably don’t&nbsp;know</a></p>&#x000A;  &#x000A;      <p>I certainly didn’t know many of the useful functions from this&nbsp;list.&#x000A;  It’s a great read for avid WordPress&nbsp;developers.&#x000A;  You may just discover an easier way to implement a feature you’ve been looking&nbsp;for.</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://web.archive.org/web/20101025124303/http://teddziuba.com/2010/10/taco-bell-programming.html">Taco Bell&nbsp;Programming</a></p>&#x000A;  &#x000A;      <p>This short but clever piece by Ted Dziuba advocates the revival of the Unix tool philosophy for modern&nbsp;tasks.&#x000A;  His brief example uses find and xargs to process a tree of files in&nbsp;parallel.&#x000A;  While I don’t think we need to start writing web apps using awk scripts, some of the ideas he mentioned could save you a lot of time in the&nbsp;future.</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://techcrunch.com/2010/10/24/firesheep-in-wolves-clothing-app-lets-you-hack-into-twitter-facebook-accounts-easily/">Firesheep in Wolves’ Clothing: Extension Lets You Hack Into Twitter, Facebook Accounts&nbsp;Easily</a>&#x000A;  Session hijacking is nothing new, but it’s almost scary how easy Firesheep exploits this attack&nbsp;vector.&#x000A;  Many sites have begun to patch themselves to prevent this&nbsp;attack.&#x000A;  Initially, connecting to a public Wi-Fi network would allow you to see who is logged in to various popular websites and with a single click, steal their login&nbsp;information.&#x000A;  Check out <a href="http://research.zscaler.com/2010/11/blacksheep-tool-to-detect-firesheep.html">BlackSheep</a> for a way to keep yourself safe by detecting&nbsp;FireSheep.</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://www.webfontawards.com/">The Web Font&nbsp;Awards</a></p>&#x000A;  &#x000A;      <p>Typography on the Web has long been a complicated&nbsp;art.&#x000A;  Unpredictable font stacks could create a different viewing experience depending on the browser and operating system visitors&nbsp;used.&#x000A;  Fortunately, web fonts now allow Web designers to use almost any font they&nbsp;desire.&#x000A;  Check out this great showcase of Web&nbsp;typography!</p>&#x000A;    </li>&#x000A;  </ul>&#x000A;  <h1><a href="/2010/10/31/blog/dangers-of-strlen.html">The Dangers of&nbsp;strlen</a></h1>&#x000A;  <p>I’ll keep this post brief, but I wanted to share something I just found about the C <code>strlen</code> function. It’s slow. It can make a big difference in program execution&nbsp;time.</p>&#x000A;  &#x000A;  <p>For example, I had a function in an external which consumes a string, so I call <code>strdup</code> each time around a loop to make sure I have a copy for the next&nbsp;iteration.</p>&#x000A;  &#x000A;  <p>In my case, the function I was calling already had the length of the string passed in as a parameter. This means <code>s2 = strdup(s1);</code> can be rewritten&nbsp;as</p>&#x000A;  &#x000A;  <div>&#x000A;  <div class="CodeRay">&#x000A;    <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>s2 = (<span style="color:#0a5;font-weight:bold">char</span>*) malloc(length);&#x000A;  <span class="line-numbers"><a href="#n2" name="n2">2</a></span>memcpy(s2, s1, length);&#x000A;  </pre></div>&#x000A;  </div>&#x000A;  </div>&#x000A;  &#x000A;  <p>Note that I used memcpy instead of&nbsp;strcpy.&#x000A;  Since we already have the length of the string, this also avoids the loop in strcpy which would be required to find the end of the&nbsp;string.&#x000A;  These kind of optimizations may seem like splitting hairs, but they can make a big difference in the overall runtime of your&nbsp;code.&#x000A;  For example, with the optimization shown above, I was able to reduce the runtime of a particular loop by around&nbsp;15%.</p>&#x000A;  &#x000A;  <p>Know of any other common functions with performance problems people may not be aware of? Share your inside info in the&nbsp;comments!</p>&#x000A;  &#x000A;  <p>Aside: While researching the performance of strlen, I came across this interesting forum post which provides an efficient strlen implementation from&nbsp;Knuth.</p>&#x000A;  &#x000A;  <h2 id="update-june-14-2012">Update: June 14,&nbsp;2012</h2>&#x000A;  &#x000A;  <p><span class="caps"><span class="caps">GCC</span></span> <span class="caps"><span class="caps">4.7.1</span></span> has an optimization to address this very issue. See the snippet below from the release&nbsp;notes.</p>&#x000A;  &#x000A;  <blockquote>&#x000A;    <p>A string length optimization pass has been added…The pass can e.g.&nbsp;optimize</p>&#x000A;  &#x000A;    <div>&#x000A;  <div class="CodeRay">&#x000A;    <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#0a5;font-weight:bold">char</span> *bar (<span style="color:#088;font-weight:bold">const</span> <span style="color:#0a5;font-weight:bold">char</span> *a)&#x000A;  <span class="line-numbers"><a href="#n2" name="n2">2</a></span>{&#x000A;  <span class="line-numbers"><a href="#n3" name="n3">3</a></span>  size_t l = strlen (a) + <span style="color:#00D">2</span>;&#x000A;  <span class="line-numbers"><a href="#n4" name="n4">4</a></span>  <span style="color:#0a5;font-weight:bold">char</span> *p = malloc (l); <span style="color:#080;font-weight:bold">if</span> (p == <span style="color:#069">NULL</span>) <span style="color:#080;font-weight:bold">return</span> p;&#x000A;  <span class="line-numbers"><a href="#n5" name="n5">5</a></span>  strcpy (p, a); strcat (p, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/</span><span style="color:#710">"</span></span>); <span style="color:#080;font-weight:bold">return</span> p;&#x000A;  <span class="line-numbers"><a href="#n6" name="n6">6</a></span>}&#x000A;  </pre></div>&#x000A;  </div>&#x000A;    </div>&#x000A;  &#x000A;    <p>into:</p>&#x000A;  &#x000A;    <div>&#x000A;  <div class="CodeRay">&#x000A;    <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#0a5;font-weight:bold">char</span> *bar (<span style="color:#088;font-weight:bold">const</span> <span style="color:#0a5;font-weight:bold">char</span> *a)&#x000A;  <span class="line-numbers"><a href="#n2" name="n2">2</a></span>{&#x000A;  <span class="line-numbers"><a href="#n3" name="n3">3</a></span>  size_t tmp = strlen (a);&#x000A;  <span class="line-numbers"><a href="#n4" name="n4">4</a></span>  <span style="color:#0a5;font-weight:bold">char</span> *p = malloc (tmp + <span style="color:#00D">2</span>); <span style="color:#080;font-weight:bold">if</span> (p == <span style="color:#069">NULL</span>) <span style="color:#080;font-weight:bold">return</span> p;&#x000A;  <span class="line-numbers"><a href="#n5" name="n5">5</a></span>  memcpy (p, a, tmp); memcpy (p + tmp, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/</span><span style="color:#710">"</span></span>, <span style="color:#00D">2</span>); <span style="color:#080;font-weight:bold">return</span> p;&#x000A;  <span class="line-numbers"><a href="#n6" name="n6">6</a></span>}&#x000A;  </pre></div>&#x000A;  </div>&#x000A;    </div>&#x000A;  </blockquote>&#x000A;  <h1><a href="/2010/10/24/blog/tweets-of-the-week.html">Octotweets</a></h1>&#x000A;  <p>In an effort to keep the blog postings more regular, I thought I would start sharing a selection of the most popular links from my Twitter feed in-between more detailed&nbsp;posts.</p>&#x000A;  &#x000A;  <ul>&#x000A;  <li>&#x000A;      <p><a href="http://www.youtube.com/watch?v=tqbiHyuGKIo">Movember Man Hypothesis – Adam&nbsp;Doran</a></p>&#x000A;  &#x000A;      <p>This one goes at the top because it’s for good friend and a good&nbsp;cause.&#x000A;  Check out this video we produced to help put our weight behind <a href="http://www.prostatecancer.ca/">Prostate Cancer Canada‘s Movember</a>&nbsp;campaign.&#x000A;  Share the video and help raise awareness about prostate&nbsp;cancer!</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://yoshinorimatsunobu.blogspot.com/2010/10/using-mysql-as-nosql-story-for.html">Yoshinori Matsunobu’s blog: Using My<span class="caps"><span class="caps">SQL</span></span> as a No<span class="caps"><span class="caps">SQL</span></span> – A story for exceeding 750,000 qps on a commodity&nbsp;server</a></p>&#x000A;  &#x000A;      <p>It’s great to see not everyone is giving up on traditional <span class="caps"><span class="caps">RDMS</span></span>&nbsp;systems.&#x000A;  Granted this isn’t a typical use (like <a href="http://code.flickr.com/blog/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/">Flickr’s abuse of My<span class="caps"><span class="caps">SQL</span></span></a>).&#x000A;  However, a lot of engineering effort has gone into these systems, and it’s a shame to see that go to&nbsp;waste.&#x000A;  Especially, when most sites never need to scale to millions of users (as much as they may wish for&nbsp;it).</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://aws.amazon.com/free/"><span class="caps"><span class="caps">AWS</span></span> Free Usage&nbsp;Tier</a>&#x000A;  I hope this serves as motivation for those who haven’t started using the cloud to at least try it&nbsp;out.&#x000A;  In the early stages of a startup, there’s no need to deal with managing your own&nbsp;hardware.&#x000A;  Great way to scale your costs with size of your&nbsp;business.</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://blog.yottaa.com/2010/10/how-to-measure-page-load-time-with-google-analytics/">How to Measure Page Load Time With Google Analytics - Web Performance&nbsp;Blog</a></p>&#x000A;  &#x000A;      <p>Coming from the boonies, with Internet connections of unreliable speed, I appreciate sites which load&nbsp;fast.&#x000A;  Of course, bandwidth may not be the only reason your site loads slow for&nbsp;users.&#x000A;  As noted in the comments on the post, you should also check out Yahoo! Boomerang which gives an easy way to ping your server with some client-side load&nbsp;statistics</p>&#x000A;    </li>&#x000A;    <li>&#x000A;      <p><a href="http://www.paulgraham.com/startupfunding.html">How to Fund a&nbsp;Startup</a></p>&#x000A;  &#x000A;      <p><a href="http://en.wikipedia.org/wiki/Paul_Graham_(computer_programmer)">Paul Graham</a> is a well known fellow within the startup&nbsp;community.&#x000A;  This post has some lovely advice for those startups a little light on&nbsp;cash.</p>&#x000A;    </li>&#x000A;  </ul>&#x000A;  <h1><a href="/2010/10/12/blog/dbus-screensaver-lock.html"><span class="caps">DBUS</span> for cross-machine screensaver locking and other cool&nbsp;things</a></h1>&#x000A;  <p>typically work with two computers on a regular&nbsp;basis.&#x000A;  When I bring my laptop into the office, that makes&nbsp;three.&#x000A;  I have a habit of locking my computer(s) when I step out, but it gets to be a pain when I have three machines running at&nbsp;once.&#x000A;  I decided that I wanted to be able to lock one machine, and have the rest follow&nbsp;suit.&#x000A;  I discovered that this is possible using <span class="caps"><span class="caps">DBUS</span></span> since gnome-screensaver emits a signal whenever locking status is&nbsp;changed.&#x000A;  I turned to my trusty Python, and started hacking&nbsp;away.</p>&#x000A;  &#x000A;  <p>Without further ado, here is the&nbsp;code:</p>&#x000A;  &#x000A;  <div>&#x000A;  <div class="CodeRay">&#x000A;    <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#777">#!/usr/bin/python</span>&#x000A;  <span class="line-numbers"> <a href="#n2" name="n2">2</a></span>&#x000A;  <span class="line-numbers"> <a href="#n3" name="n3">3</a></span><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">dbus</span>&#x000A;  <span class="line-numbers"> <a href="#n4" name="n4">4</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">dbus.mainloop.glib</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">DBusGMainLoop</span>&#x000A;  <span class="line-numbers"> <a href="#n5" name="n5">5</a></span><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">gobject</span>&#x000A;  <span class="line-numbers"> <a href="#n6" name="n6">6</a></span><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">os</span>&#x000A;  <span class="line-numbers"> <a href="#n7" name="n7">7</a></span>&#x000A;  <span class="line-numbers"> <a href="#n8" name="n8">8</a></span><span style="color:#777"># Hosts which should be locked/unlocked</span>&#x000A;  <span class="line-numbers"> <a href="#n9" name="n9">9</a></span>hosts = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">starks</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mmior-laptop</span><span style="color:#710">'</span></span>]&#x000A;  <span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span><span style="color:#777"># Set to True to turn on displays of other</span>&#x000A;  <span class="line-numbers"><a href="#n11" name="n11">11</a></span><span style="color:#777"># hosts after unlocking</span>&#x000A;  <span class="line-numbers"><a href="#n12" name="n12">12</a></span>wake = <span style="color:#069">False</span>&#x000A;  <span class="line-numbers"><a href="#n13" name="n13">13</a></span>&#x000A;  <span class="line-numbers"><a href="#n14" name="n14">14</a></span><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">toggle_lock</span>(x):&#x000A;  <span class="line-numbers"><a href="#n15" name="n15">15</a></span>  <span style="color:#080;font-weight:bold">if</span> x == <span style="color:#00D">0</span>:&#x000A;  <span class="line-numbers"><a href="#n16" name="n16">16</a></span>    <span style="color:#080;font-weight:bold">for</span> host <span style="color:#080;font-weight:bold">in</span> hosts:&#x000A;  <span class="line-numbers"><a href="#n17" name="n17">17</a></span>      os.system(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ssh </span><span style="color:#710">'</span></span> + host + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> export DISPLAY=:0; gnome-screensaver-command -d</span><span style="color:#710">'</span></span>)&#x000A;  <span class="line-numbers"><a href="#n18" name="n18">18</a></span>      <span style="color:#080;font-weight:bold">if</span> wake:&#x000A;  <span class="line-numbers"><a href="#n19" name="n19">19</a></span>        os.system(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ssh </span><span style="color:#710">'</span></span> + host + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> export DISPLAY=:0; xset dpms force on; gnome-screensaver-command -d</span><span style="color:#710">'</span></span>)&#x000A;  <span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>  <span style="color:#080;font-weight:bold">if</span> x == <span style="color:#00D">1</span>:&#x000A;  <span class="line-numbers"><a href="#n21" name="n21">21</a></span>    os.system(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xset s activate</span><span style="color:#710">'</span></span>)&#x000A;  <span class="line-numbers"><a href="#n22" name="n22">22</a></span>    <span style="color:#080;font-weight:bold">for</span> host <span style="color:#080;font-weight:bold">in</span> hosts:&#x000A;  <span class="line-numbers"><a href="#n23" name="n23">23</a></span>      os.system(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ssh </span><span style="color:#710">'</span></span> + host + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> export DISPLAY=:0; xset dpms force off; gnome-screensaver-command -l</span><span style="color:#710">'</span></span>)&#x000A;  <span class="line-numbers"><a href="#n24" name="n24">24</a></span>&#x000A;  <span class="line-numbers"><a href="#n25" name="n25">25</a></span>DBusGMainLoop(set_as_default=<span style="color:#069">True</span>)&#x000A;  <span class="line-numbers"><a href="#n26" name="n26">26</a></span>&#x000A;  <span class="line-numbers"><a href="#n27" name="n27">27</a></span><span style="color:#777"># Connect to the session bus and</span>&#x000A;  <span class="line-numbers"><a href="#n28" name="n28">28</a></span><span style="color:#777"># install our signal handler</span>&#x000A;  <span class="line-numbers"><a href="#n29" name="n29">29</a></span>bus = dbus.SessionBus()&#x000A;  <span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>bus.add_signal_receiver(toggle_lock,&#x000A;  <span class="line-numbers"><a href="#n31" name="n31">31</a></span>  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActiveChanged</span><span style="color:#710">'</span></span>,&#x000A;  <span class="line-numbers"><a href="#n32" name="n32">32</a></span>  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.gnome.ScreenSaver</span><span style="color:#710">'</span></span>,&#x000A;  <span class="line-numbers"><a href="#n33" name="n33">33</a></span>  path=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/org/gnome/ScreenSaver</span><span style="color:#710">'</span></span>)&#x000A;  <span class="line-numbers"><a href="#n34" name="n34">34</a></span>&#x000A;  <span class="line-numbers"><a href="#n35" name="n35">35</a></span><span style="color:#777"># Start the loop and wait for the signal</span>&#x000A;  <span class="line-numbers"><a href="#n36" name="n36">36</a></span>gobject.MainLoop().run()&#x000A;  <span class="line-numbers"><a href="#n37" name="n37">37</a></span>&#x000A;  <span class="line-numbers"><a href="#n38" name="n38">38</a></span><span style="color:#777"># Clean up by removing the signal handler</span>&#x000A;  <span class="line-numbers"><a href="#n39" name="n39">39</a></span>bus.remove_signal_receiver(toggle_lock,&#x000A;  <span class="line-numbers"><strong><a href="#n40" name="n40">40</a></strong></span>  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActiveChanged</span><span style="color:#710">'</span></span>,&#x000A;  <span class="line-numbers"><a href="#n41" name="n41">41</a></span>  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.gnome.ScreenSaver</span><span style="color:#710">'</span></span>,&#x000A;  <span class="line-numbers"><a href="#n42" name="n42">42</a></span>  path=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/org/gnome/ScreenSaver</span><span style="color:#710">'</span></span>)&#x000A;  </pre></div>&#x000A;  </div>&#x000A;  </div>&#x000A;  &#x000A;  <p>This needs to be run as a daemon in the background to watch for the&nbsp;signal.&#x000A;  To use the script, just replace the hosts array with a list of hostnames you wish to&nbsp;lock/unlock.&#x000A;  The wake variable controls whether or not the screens of the other machines should be turned on when&nbsp;unlocked.&#x000A;  Of course you can add any actions you wish to take on&nbsp;lock/unlock.</p>&#x000A;  &#x000A;  <p>For more information, check out the <a href="http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html">Python <span class="caps"><span class="caps">DBUS</span></span> tutorial</a> or see how to use <a href="http://linux.die.net/man/1/dbus-monitor"><code>dbus-monitor</code></a> to watch for any signals going over the&nbsp;bus.</p>&#x000A;  &#x000A;  <p>If you want to poke around and see what <span class="caps"><span class="caps">DBUS</span></span> interfaces various programs you have installed, check out the Debian package&nbsp;<code>qt4-dev-tools</code>.&#x000A;  It may be a little big since it requires installing lots of Qt libraries, but the included <code>qdbusviewer</code> tool is great for browsing signals and testing out message&nbsp;sending.</p>&#x000A;  &#x000A;  <p>If you run into any problems or come up with a cool use case, let me know in the&nbsp;comments!</p>&#x000A;</div>
          </div>
        </div>
      </div>
    </div>
    <div id='footer'>
      <div id='siteinfo'>
        &copy; 2013 Michael Mior
      </div>
    </div>
  </body>
</html>
